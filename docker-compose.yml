services:
  discord-bot:
    image: ghcr.io/leCielEtoile/discord-bot-r2:latest
    
    # ğŸ”§ é–‹ç™ºæ™‚ã‚„ã‚«ã‚¹ã‚¿ãƒ ãƒ“ãƒ«ãƒ‰ãŒå¿…è¦ãªå ´åˆ
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    #   cache_from:
    #     - ghcr.io/leCielEtoile/discord-bot-r2:latest
    #   args:
    #     BUILD_DATE: ${BUILD_DATE:-$(date -u +'%Y-%m-%dT%H:%M:%SZ')}
    #     VCS_REF: ${VCS_REF:-$(git rev-parse --short HEAD)}
    container_name: discord-ytdl-bot
    restart: unless-stopped
    volumes:
      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ã§ãƒã‚¦ãƒ³ãƒˆï¼‰
      - ./config.yaml:/app/config.yaml:ro
      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ°¸ç¶šåŒ–
      - ./data:/app/data
      # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®æ°¸ç¶šåŒ–
      - ./logs:/app/logs
    environment:
      # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚ˆã‚Šã‚‚ç’°å¢ƒå¤‰æ•°ã‚’å„ªå…ˆã™ã‚‹å ´åˆã¯ã“ã“ã§æŒ‡å®š
      # - DISCORD_TOKEN=your-token-here
      # - R2_BUCKET=your-bucket
      # - R2_ENDPOINT=your-endpoint
      # - R2_ACCESS_KEY=your-access-key
      # - R2_SECRET_KEY=your-secret-key
      # - R2_PUBLIC_URL=your-public-url
      
      # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å›ºæœ‰ã®ç’°å¢ƒå¤‰æ•°
      - CONFIG_PATH=/app/config.yaml
      - LOG_LEVEL=INFO
      - DB_PATH=/app/data/db.sqlite3
      - XDG_CACHE_HOME=/app/data/cache
    
    # ã‚³ãƒ³ãƒ†ãƒŠã®å¥å…¨æ€§ãƒã‚§ãƒƒã‚¯
    healthcheck:
      test: ["CMD", "ps", "aux", "|", "grep", "python", "|", "grep", "-v", "grep"]
      interval: 30s      # 30ç§’é–“éš”ã§ãƒã‚§ãƒƒã‚¯
      timeout: 10s       # 10ç§’ã§ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
      retries: 3         # 3å›å¤±æ•—ã§ç•°å¸¸åˆ¤å®š
      start_period: 10s  # èµ·å‹•ã‹ã‚‰10ç§’ã¯çŒ¶äºˆæœŸé–“

# é–‹ç™ºç”¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ“ãƒ«ãƒ‰ï¼‰
  discord-bot-dev:
    build:
      context: .
      dockerfile: Dockerfile
      cache_from:
        - ghcr.io/YOUR_USERNAME/YOUR_REPOSITORY:latest
        - ghcr.io/YOUR_USERNAME/YOUR_REPOSITORY:develop
      args:
        BUILD_DATE: ${BUILD_DATE:-$(date -u +'%Y-%m-%dT%H:%M:%SZ')}
        VCS_REF: ${VCS_REF:-$(git rev-parse --short HEAD)}
    
    container_name: discord-ytdl-bot-dev
    restart: unless-stopped
    profiles: ["dev"]  # docker-compose --profile dev up ã§èµ·å‹•
    
    volumes:
      - ./config.yaml:/app/config.yaml:ro
      - ./data:/app/data
      - ./logs:/app/logs
    
    environment:
      - CONFIG_PATH=/app/config.yaml
      - LOG_LEVEL=DEBUG  # è©³ç´°ãƒ­ã‚°
      - DB_PATH=/app/data/db.sqlite3
      - XDG_CACHE_HOME=/app/data/cache